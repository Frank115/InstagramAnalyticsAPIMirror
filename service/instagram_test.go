package service_test

import (
	"testing"

	"github.com/ProyectoIT/InstagramAnalyticsAPI/service"
	"github.com/stretchr/testify/assert"
	gock "gopkg.in/h2non/gock.v1"
)

func TestGetInstagramGis(t *testing.T) {
	gock.New("https://www.instagram.com").
		Get("/").
		Reply(200).
		BodyString(`<script type="text/javascript">window._sharedData = {"activity_counts":null,"config":{"csrf_token":"icHDcDMClnMMvYXbumNJ8JOE99OxzNvw","viewer":null},"supports_es6":true,"country_code":"AR","language_code":"en","locale":"en_US","entry_data":{"LandingPage":[{"captcha":{"enabled":false,"key":""},"hsite_redirect_url":"","prefill_phone_number":"","gdpr_required":false,"tos_version":"row"}]},"gatekeepers":{"sf":true,"ld":true,"seo":true,"seoht":true,"saa":true},"knobs":{"acct:ntb":0,"cb":0,"captcha":0},"qe":{"form_navigation_dialog":{"g":"","p":{}},"cred_man":{"g":"","p":{}},"iab":{"g":"","p":{}},"app_upsell_li":{"g":"","p":{}},"app_upsell":{"g":"","p":{}},"stale_fix":{"g":"","p":{}},"dash_for_vod":{"g":"","p":{}},"profile_header_name":{"g":"","p":{}},"bc3l":{"g":"","p":{}},"direct_conversation_reporting":{"g":"","p":{}},"general_reporting":{"g":"","p":{}},"reporting":{"g":"","p":{}},"acc_recovery_link":{"g":"","p":{}},"notif":{"g":"","p":{}},"fb_unlink":{"g":"","p":{}},"mobile_stories_doodling":{"g":"","p":{}},"mobile_cancel":{"g":"","p":{}},"show_copy_link":{"g":"","p":{}},"mobile_logout":{"g":"","p":{}},"p_edit":{"g":"","p":{}},"404_as_react":{"g":"","p":{}},"acc_recovery":{"g":"test_05_29","p":{"can_reset_by_phone":"true"}},"collections":{"g":"","p":{}},"comment_ta":{"g":"","p":{}},"su":{"g":"","p":{}},"disc_ppl":{"g":"","p":{}},"ebd_ul":{"g":"","p":{}},"ebdsim_li":{"g":"","p":{}},"ebdsim_lo":{"g":"","p":{}},"empty_feed":{"g":"","p":{}},"bundles":{"g":"","p":{}},"exit_story_creation":{"g":"","p":{}},"appsell":{"g":"","p":{}},"imgopt":{"g":"","p":{}},"follow_button":{"g":"","p":{}},"loggedout":{"g":"","p":{}},"loggedout_upsell":{"g":"test_with_new_loggedout_upsell_content_03_15_18","p":{"has_new_loggedout_upsell_content":"true"}},"msisdn":{"g":"","p":{}},"bg_sync":{"g":"","p":{}},"onetaplogin":{"g":"","p":{}},"login_poe":{"g":"","p":{}},"private_lo":{"g":"","p":{}},"profile_tabs":{"g":"","p":{}},"push_notifications":{"g":"","p":{}},"reg":{"g":"","p":{}},"reg_vp":{"g":"","p":{}},"report_media":{"g":"","p":{}},"report_profile":{"g":"","p":{}},"scroll_log":{"g":"","p":{}},"sidecar_swipe":{"g":"","p":{}},"su_universe":{"g":"","p":{}},"stale":{"g":"","p":{}},"stories_lo":{"g":"","p":{}},"stories":{"g":"","p":{}},"tp_pblshr":{"g":"","p":{}},"video":{"g":"","p":{}},"gdpr_eu_tos":{"g":"","p":{}},"gdpr_row_tos":{"g":"test_05_01","p":{"tos_version":"row"}},"fd_gr":{"g":"","p":{}},"felix":{"g":"","p":{}},"felix_clear_fb_cookie":{"g":"","p":{}},"felix_creation_duration_limits":{"g":"","p":{}},"felix_creation_enabled":{"g":"","p":{}},"felix_creation_fb_crossposting":{"g":"","p":{}},"felix_creation_fb_crossposting_v2":{"g":"","p":{}},"felix_creation_validation":{"g":"","p":{}},"felix_creation_video_upload":{"g":"","p":{}},"felix_early_onboarding":{"g":"","p":{}},"pride":{"g":"","p":{}},"unfollow_confirm":{"g":"","p":{}},"profile_enhance_li":{"g":"","p":{}},"profile_enhance_lo":{"g":"","p":{}},"phone_confirm":{"g":"","p":{}},"comment_enhance":{"g":"","p":{}},"mweb_media_chaining":{"g":"","p":{}},"mweb_topical_explore":{"g":"","p":{}},"web_nametag":{"g":"","p":{}},"image_downgrade":{"g":"","p":{}},"image_downgrade_lite":{"g":"","p":{}},"follow_all_fb":{"g":"","p":{}},"lite_direct_upsell":{"g":"","p":{}},"web_loggedout_noop":{"g":"","p":{}},"stories_video_preload":{"g":"","p":{}},"lite_stories_video_preload":{"g":"","p":{}},"a2hs_heuristic_uc":{"g":"","p":{}},"a2hs_heuristic_non_uc":{"g":"","p":{}},"web_hashtag":{"g":"","p":{}},"header_scroll":{"g":"","p":{}},"rout":{"g":"","p":{}},"websr":{"g":"","p":{}},"web_lo_follow":{"g":"","p":{}},"web_share":{"g":"","p":{}},"lite_rating":{"g":"","p":{}},"web_embeds_share":{"g":"control","p":{"show_button":"false"}},"web_share_lo":{"g":"","p":{}},"web_embeds_logged_out":{"g":"test_comment_count","p":{"show_comment_count":"true"}}},"hostname":"www.instagram.com","platform":"web","rhx_gis":"34e9923aab0cacbdb89c3dc87b9ffe8f","nonce":"EKLYO45xhOfZt95/L8b2Zg==","zero_data":{},"rollout_hash":"6c1f67754dc0","bundle_variant":"base","probably_has_app":false,"show_app_install":true};</script>`)
	assert.Equal(t, "d6888a00d2d255ece3a66071fffac5b0", service.GetInstagramGisHash(`{"id":1}`))
}
